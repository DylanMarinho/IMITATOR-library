{
  "jani-version": 1,
  "name": "Coffee/CoffeeDrinker/coffeeDrinker_toolpaper.imi",
  "type": "sha",
  "features": [
    "derived-operators"
  ],
  "actions": [
    {
      "name": "press"
    },
    {
      "name": "cup"
    },
    {
      "name": "coffee"
    },
    {
      "name": "sleep"
    }
  ],
  "variables": [
    {
      "name": "x",
      "type": "clock",
      "initial_value": 0
    },
    {
      "name": "y1",
      "type": "clock",
      "initial_value": 0
    },
    {
      "name": "y2",
      "type": "clock",
      "initial_value": 0
    },
    {
      "name": "nb_sugar",
      "type": "int",
      "initial_value": 0
    },
    {
      "name": "p_add_sugar",
      "type": "real"
    },
    {
      "name": "p_coffee",
      "type": "real"
    },
    {
      "name": "p_button",
      "type": "real"
    }
  ],
  "properties": [],
  "automata": [
    {
      "name": "machine",
      "locations": [
        {
          "name": "idle"
        },
        {
          "name": "add_sugar",
          "time-progress": {
            "exp": {
              "op": ">",
              "left": "p_add_sugar",
              "right": "x"
            }
          }
        },
        {
          "name": "preparing_coffee",
          "time-progress": {
            "exp": {
              "op": ">",
              "left": "p_coffee",
              "right": "x"
            }
          }
        },
        {
          "name": "cdone",
          "time-progress": {
            "exp": {
              "op": ">",
              "left": 10,
              "right": "x"
            }
          }
        }
      ],
      "initial_locations": [
        "idle"
      ],
      "edges": [
        {
          "location": "idle",
          "destinations": [
            {
              "location": "add_sugar",
              "assignments": [
                {
                  "ref": "x",
                  "value": 0
                }
              ]
            }
          ]
        },
        {
          "location": "add_sugar",
          "destinations": [
            {
              "location": "add_sugar"
            }
          ]
        },
        {
          "location": "add_sugar",
          "guard": {
            "op": "=",
            "left": "p_add_sugar",
            "right": "x"
          },
          "destinations": [
            {
              "location": "preparing_coffee",
              "assignments": [
                {
                  "ref": "x",
                  "value": 0
                }
              ]
            }
          ]
        },
        {
          "location": "preparing_coffee",
          "guard": {
            "op": "=",
            "left": "p_coffee",
            "right": "x"
          },
          "destinations": [
            {
              "location": "cdone",
              "assignments": [
                {
                  "ref": "x",
                  "value": 0
                }
              ]
            }
          ]
        },
        {
          "location": "cdone",
          "destinations": [
            {
              "location": "add_sugar",
              "assignments": [
                {
                  "ref": "x",
                  "value": 0
                }
              ]
            }
          ]
        },
        {
          "location": "cdone",
          "guard": {
            "op": "=",
            "left": "x",
            "right": 10
          },
          "destinations": [
            {
              "location": "idle"
            }
          ]
        }
      ]
    },
    {
      "name": "researcher",
      "locations": [
        {
          "name": "researching",
          "time-progress": {
            "exp": {
              "op": ">",
              "left": 7200,
              "right": "y1"
            }
          }
        },
        {
          "name": "add_sugar",
          "time-progress": {
            "exp": {
              "op": "∧",
              "left": {
                "op": "≤",
                "left": "nb_sugar",
                "right": {
                  "op": " - ",
                  "left": 3,
                  "right": 1
                }
              },
              "right": {
                "op": "∧",
                "left": {
                  "op": ">",
                  "left": 15,
                  "right": "y2"
                },
                "right": {
                  "op": ">",
                  "left": "p_button",
                  "right": "y1"
                }
              }
            }
          }
        },
        {
          "name": "wait_coffee",
          "time-progress": {
            "exp": {
              "op": ">",
              "left": 15,
              "right": "y2"
            }
          }
        },
        {
          "name": "mad"
        }
      ],
      "initial_locations": [
        "researching"
      ],
      "edges": [
        {
          "location": "researching",
          "guard": {
            "op": ">",
            "left": "y1",
            "right": 3600
          },
          "destinations": [
            {
              "location": "add_sugar",
              "assignments": [
                {
                  "ref": "y1",
                  "value": 0
                },
                {
                  "ref": "y2",
                  "value": 0
                },
                {
                  "ref": "nb_sugar",
                  "value": 0
                }
              ]
            }
          ]
        },
        {
          "location": "add_sugar",
          "guard": {
            "op": "∧",
            "left": {
              "op": "=",
              "left": "nb_sugar",
              "right": {
                "op": " - ",
                "left": 3,
                "right": 1
              }
            },
            "right": {
              "op": "=",
              "left": "p_button",
              "right": "y1"
            }
          },
          "destinations": [
            {
              "location": "wait_coffee",
              "assignments": [
                {
                  "ref": "nb_sugar",
                  "value": {
                    "op": " + ",
                    "left": "nb_sugar",
                    "right": 1
                  }
                }
              ]
            }
          ]
        },
        {
          "location": "add_sugar",
          "guard": {
            "op": "∧",
            "left": {
              "op": "<",
              "left": "nb_sugar",
              "right": {
                "op": " - ",
                "left": 3,
                "right": 1
              }
            },
            "right": {
              "op": "=",
              "left": "p_button",
              "right": "y1"
            }
          },
          "destinations": [
            {
              "location": "add_sugar",
              "assignments": [
                {
                  "ref": "y1",
                  "value": 0
                },
                {
                  "ref": "nb_sugar",
                  "value": {
                    "op": " + ",
                    "left": "nb_sugar",
                    "right": 1
                  }
                }
              ]
            }
          ]
        },
        {
          "location": "add_sugar",
          "guard": {
            "op": "=",
            "left": "y2",
            "right": 15
          },
          "destinations": [
            {
              "location": "mad"
            }
          ]
        },
        {
          "location": "add_sugar",
          "destinations": [
            {
              "location": "mad"
            }
          ]
        },
        {
          "location": "wait_coffee",
          "guard": {
            "op": "≥",
            "left": 15,
            "right": "y2"
          },
          "destinations": [
            {
              "location": "researching",
              "assignments": [
                {
                  "ref": "y1",
                  "value": 0
                },
                {
                  "ref": "y2",
                  "value": 0
                }
              ]
            }
          ]
        },
        {
          "location": "wait_coffee",
          "guard": {
            "op": "=",
            "left": "y2",
            "right": 15
          },
          "destinations": [
            {
              "location": "mad"
            }
          ]
        },
        {
          "location": "mad",
          "destinations": [
            {
              "location": "mad"
            }
          ]
        }
      ]
    }
  ],
  "system": {
    "elements": [
      {
        "automaton": "machine"
      },
      {
        "automaton": "researcher"
      }
    ],
    "syncs": [
      {
        "synchronise": [
          "press",
          "press"
        ],
        "result": "press"
      },
      {
        "synchronise": [
          "cup",
          null
        ],
        "result": "cup"
      },
      {
        "synchronise": [
          "coffee",
          "coffee"
        ],
        "result": "coffee"
      },
      {
        "synchronise": [
          "sleep",
          null
        ],
        "result": "sleep"
      }
    ]
  }
}
